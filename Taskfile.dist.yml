---
version: "3"

includes:
  gotest:
    taskfile: ../taskfiles/gotest.yml
    # optional because the ../taskfiles dir is cloned via bootstrap below
    optional: true
    dir: .
  azurite:
    taskfile: ../taskfiles/azurite.yml
    # optional because the ../taskfiles dir is cloned via bootstrap below
    optional: true
    dir: .

tasks:

  bootstrap:
    desc: bootstrap the development environment
    cmds:
      - |
        GIT_BOOTSTRAP_SH=$(curl -fsSL https://raw.githubusercontent.com/robinbryce/git-bootstrap/refs/heads/main/git-bootstrap.v2.sh)
        sh -c "$GIT_BOOTSTRAP_SH" - clone .

  test:
    desc: run all the tests
    cmds:
      - task: test:unit
      - task: test:integration

  test:unit:
    desc: run the unit tests
    cmds:
      - task: gotest:unit

  test:integration:
    cmds:
      - task: azurite:preflight
      - task: gotest:integration
      - task: azurite:stop
